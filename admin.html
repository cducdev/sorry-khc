<!DOCTYPE html>
<html lang="vi">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Admin Panel - Phi√™n T√≤a X√©t X·ª≠</title>
		<link rel="stylesheet" href="style.css" />
		<link
			href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@300;400;500;700&display=swap"
			rel="stylesheet"
		/>
		<style>
			.admin-container {
			    max-width: 800px;
			    margin: 2rem auto;
			    padding: 2rem;
			    background: white;
			    border-radius: 20px;
			    box-shadow: 0 10px 30px var(--shadow-color);
			}

			.admin-header {
			    text-align: center;
			    margin-bottom: 2rem;
			    padding-bottom: 1rem;
			    border-bottom: 2px solid var(--accent-color);
			}

			.admin-section {
			    margin-bottom: 2rem;
			    padding: 1.5rem;
			    background: var(--background-color);
			    border-radius: 15px;
			}

			.admin-section h2 {
			    color: var(--primary-color);
			    margin-bottom: 1rem;
			    font-family: 'Playfair Display', serif;
			}

			.config-item {
			    display: flex;
			    align-items: center;
			    margin-bottom: 1rem;
			    padding: 1rem;
			    background: white;
			    border-radius: 10px;
			    box-shadow: 0 2px 5px var(--shadow-color);
			}

			.config-label {
			    flex: 1;
			    font-weight: 500;
			    color: var(--text-color);
			}

			.config-value {
			    flex: 2;
			    color: var(--primary-color);
			}

			.offense-list, .punishment-list {
			    list-style: none;
			    padding: 0;
			}

			.offense-list li, .punishment-list li {
			    padding: 0.8rem;
			    margin-bottom: 0.5rem;
			    background: white;
			    border-radius: 8px;
			    display: flex;
			    align-items: center;
			    gap: 1rem;
			}

			.stats {
			    display: grid;
			    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
			    gap: 1rem;
			    margin-top: 1rem;
			}

			.stat-card {
			    background: white;
			    padding: 1rem;
			    border-radius: 10px;
			    text-align: center;
			    box-shadow: 0 2px 5px var(--shadow-color);
			}

			.stat-value {
			    font-size: 2rem;
			    color: var(--primary-color);
			    font-weight: bold;
			    margin: 0.5rem 0;
			}

			.stat-label {
			    color: var(--text-color);
			    font-size: 0.9rem;
			}

			.refresh-button {
			    background: var(--primary-color);
			    color: white;
			    border: none;
			    padding: 0.8rem 1.5rem;
			    border-radius: 10px;
			    cursor: pointer;
			    font-size: 1.1rem;
			    transition: all 0.3s ease;
			    display: block;
			    margin: 1rem auto;
			}

			.refresh-button:hover {
			    transform: translateY(-2px);
			    box-shadow: 0 5px 15px var(--shadow-color);
			}

			.timestamp {
			    text-align: center;
			    color: var(--text-color);
			    font-size: 0.9rem;
			    margin-top: 1rem;
			}

			.offense-list li {
			    display: flex;
			    align-items: center;
			    gap: 1rem;
			    padding: 1rem;
			    background: white;
			    border-radius: 8px;
			    margin-bottom: 0.5rem;
			    box-shadow: 0 2px 5px var(--shadow-color);
			}

			.offense-number {
			    color: var(--primary-color);
			    font-weight: bold;
			    min-width: 2rem;
			}

			.offense-text {
			    flex: 1;
			}

			.pardon-status {
			    background: white;
			    padding: 1.5rem;
			    border-radius: 10px;
			    box-shadow: 0 2px 5px var(--shadow-color);
			}

			.status-message {
			    color: var(--text-color);
			    font-size: 1.1rem;
			    text-align: center;
			}

			.pardon-info {
			    margin-top: 1rem;
			    padding-top: 1rem;
			    border-top: 1px solid var(--border-color);
			}

			.pardon-info p {
			    margin: 0.5rem 0;
			    color: var(--text-color);
			}

			.pardon-info .highlight {
			    color: var(--primary-color);
			    font-weight: 500;
			}

			.pardon-info .timestamp {
			    font-size: 0.9rem;
			    color: var(--text-color);
			    opacity: 0.8;
			}
		</style>
	</head>
	<body>
		<div class="admin-container">
			<div class="admin-header">
				<h1>Admin Panel</h1>
				<p>Qu·∫£n l√Ω c·∫•u h√¨nh phi√™n t√≤a</p>
			</div>

			<div class="admin-section">
				<h2>Th√¥ng Tin C∆° B·∫£n</h2>
				<div class="config-item">
					<span class="config-label">B·ªã C√°o:</span>
					<span class="config-value" id="admin-your-name"></span>
				</div>
				<div class="config-item">
					<span class="config-label">Ch·ªß T·ªça:</span>
					<span class="config-value" id="admin-her-name"></span>
				</div>
			</div>

			<div class="admin-section">
				<h2>Danh S√°ch T·ªôi Danh</h2>
				<ul class="offense-list" id="admin-offenses"></ul>
			</div>

			<div class="admin-section">
				<h2>Danh S√°ch H√¨nh Ph·∫°t</h2>
				<ul class="punishment-list" id="admin-punishments"></ul>
			</div>

			<div class="admin-section">
				<h2>Th·ªëng K√™</h2>
				<div class="stats">
					<div class="stat-card">
						<div class="stat-value" id="total-offenses">0</div>
						<div class="stat-label">T·ªïng s·ªë t·ªôi danh</div>
					</div>
					<div class="stat-card">
						<div class="stat-value" id="total-punishments">0</div>
						<div class="stat-label">T·ªïng s·ªë h√¨nh ph·∫°t</div>
					</div>
				</div>
			</div>

			<div class="admin-section">
				<h2>Tr·∫°ng Th√°i √Çn X√°</h2>
				<div id="pardon-status" class="pardon-status">
					<div class="status-message">
						Ch∆∞a c√≥ quy·∫øt ƒë·ªãnh √¢n x√° n√†o
					</div>
				</div>
			</div>

			<button class="refresh-button" id="refresh-button">
				<span class="button-icon">üîÑ</span>
				L√†m m·ªõi d·ªØ li·ªáu
			</button>

			<div class="timestamp" id="last-updated"></div>
		</div>

		<script src="config.js"></script>
		<script>
			// H√†m ƒë·ªÉ t·∫£i l·∫°i file config.js
			function reloadConfig() {
			    return new Promise((resolve, reject) => {
			        // X√≥a script c≈© n·∫øu c√≥
			        const oldScript = document.querySelector('script[src^="config.js"]');
			        if (oldScript) {
			            oldScript.remove();
			        }

			        // T·∫°o script m·ªõi
			        const script = document.createElement('script');
			        script.src = 'config.js?' + new Date().getTime();
			        script.onload = () => {
			            // ƒê·ª£i m·ªôt ch√∫t ƒë·ªÉ ƒë·∫£m b·∫£o config ƒë√£ ƒë∆∞·ª£c t·∫£i
			            setTimeout(() => {
			                if (typeof config !== 'undefined') {
			                    resolve();
			                } else {
			                    reject(new Error('Kh√¥ng th·ªÉ t·∫£i c·∫•u h√¨nh'));
			                }
			            }, 100);
			        };
			        script.onerror = reject;
			        document.body.appendChild(script);
			    });
			}

			// H√†m ƒë·ªÉ c·∫≠p nh·∫≠t giao di·ªán
			function updateAdminPanel() {
			    if (typeof config === 'undefined') {
			        console.error('Config ch∆∞a ƒë∆∞·ª£c t·∫£i');
			        return;
			    }

			    try {
			        // C·∫≠p nh·∫≠t th√¥ng tin c∆° b·∫£n
			        document.getElementById('admin-your-name').textContent = config.yourName || 'Ch∆∞a c√≥';
			        document.getElementById('admin-her-name').textContent = config.herName || 'Ch∆∞a c√≥';

			        // C·∫≠p nh·∫≠t danh s√°ch t·ªôi danh
			        const offensesList = document.getElementById('admin-offenses');
			        offensesList.innerHTML = '';
			        if (Array.isArray(config.offenses) && config.offenses.length > 0) {
			            config.offenses.forEach((offense, index) => {
			                const li = document.createElement('li');
			                li.innerHTML = `
			                    <span class="offense-number">${index + 1}.</span>
			                    <span class="offense-text">${offense}</span>
			                `;
			                offensesList.appendChild(li);
			            });
			        } else {
			            const li = document.createElement('li');
			            li.textContent = 'Ch∆∞a c√≥ t·ªôi danh n√†o';
			            offensesList.appendChild(li);
			        }

			        // C·∫≠p nh·∫≠t danh s√°ch h√¨nh ph·∫°t
			        const punishmentsList = document.getElementById('admin-punishments');
			        punishmentsList.innerHTML = '';
			        if (Array.isArray(config.punishments) && config.punishments.length > 0) {
			            config.punishments.forEach((punishment, index) => {
			                const li = document.createElement('li');
			                li.innerHTML = `
			                    <span class="punishment-number">${index + 1}.</span>
			                    <span class="punishment-icon">${punishment.icon || '‚öñÔ∏è'}</span>
			                    <span class="punishment-text">${punishment.text || 'Ch∆∞a c√≥ m√¥ t·∫£'}</span>
			                `;
			                punishmentsList.appendChild(li);
			            });
			        } else {
			            const li = document.createElement('li');
			            li.textContent = 'Ch∆∞a c√≥ h√¨nh ph·∫°t n√†o';
			            punishmentsList.appendChild(li);
			        }

			        // C·∫≠p nh·∫≠t th·ªëng k√™
			        document.getElementById('total-offenses').textContent =
			            Array.isArray(config.offenses) ? config.offenses.length : 0;
			        document.getElementById('total-punishments').textContent =
			            Array.isArray(config.punishments) ? config.punishments.length : 0;

			        // C·∫≠p nh·∫≠t th·ªùi gian
			        const now = new Date();
			        document.getElementById('last-updated').textContent =
			            `C·∫≠p nh·∫≠t l·∫ßn cu·ªëi: ${now.toLocaleString('vi-VN')}`;
			    } catch (error) {
			        console.error('L·ªói khi c·∫≠p nh·∫≠t giao di·ªán:', error);
			        alert('C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t giao di·ªán. Vui l√≤ng th·ª≠ l·∫°i.');
			    }
			}

			// H√†m ƒë·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i √¢n x√°
			async function updatePardonStatus() {
			    const pardonStatus = document.getElementById('pardon-status');

			    try {
			        const response = await fetch('/get-status');
			        const data = await response.json();

			        if (data.timestamp) {
			            const date = new Date(data.timestamp);
			            pardonStatus.innerHTML = `
			                <div class="status-message">‚úÖ ƒê√£ c√≥ quy·∫øt ƒë·ªãnh √¢n x√°!</div>
			                <div class="pardon-info">
			                    <p>B·ªã c√°o: <span class="highlight">${data.yourName}</span></p>
			                    <p>Ch·ªß t·ªça: <span class="highlight">${data.herName}</span></p>
			                    <p class="timestamp">Th·ªùi gian: ${date.toLocaleString('vi-VN')}</p>
			                </div>
			            `;
			        } else {
			            pardonStatus.innerHTML = `
			                <div class="status-message">‚è≥ Ch∆∞a c√≥ quy·∫øt ƒë·ªãnh √¢n x√° n√†o</div>
			            `;
			        }
			    } catch (error) {
			        console.error('L·ªói khi ƒë·ªçc tr·∫°ng th√°i:', error);
			        pardonStatus.innerHTML = `
			            <div class="status-message">‚ùå L·ªói khi ƒë·ªçc tr·∫°ng th√°i</div>
			        `;
			    }
			}

			// C·∫≠p nh·∫≠t l·∫ßn ƒë·∫ßu khi trang ƒë∆∞·ª£c t·∫£i
			document.addEventListener('DOMContentLoaded', () => {
			    if (typeof config === 'undefined') {
			        console.error('Config ch∆∞a ƒë∆∞·ª£c t·∫£i khi kh·ªüi ƒë·ªông');
			        return;
			    }
			    updateAdminPanel();
			    updatePardonStatus();
			});

			// C·∫≠p nh·∫≠t khi nh·∫•n n√∫t refresh
			document.getElementById('refresh-button').addEventListener('click', async () => {
			    try {
			        // Th√™m hi·ªáu ·ª©ng loading
			        const button = document.getElementById('refresh-button');
			        const originalText = button.innerHTML;
			        button.innerHTML = 'üîÑ ƒêang t·∫£i...';
			        button.disabled = true;

			        // T·∫£i l·∫°i config v√† c·∫≠p nh·∫≠t giao di·ªán
			        await reloadConfig();
			        await updateAdminPanel();
			        await updatePardonStatus();

			        // Kh√¥i ph·ª•c n√∫t
			        button.innerHTML = originalText;
			        button.disabled = false;
			    } catch (error) {
			        console.error('L·ªói khi t·∫£i l·∫°i d·ªØ li·ªáu:', error);
			        alert('C√≥ l·ªói x·∫£y ra khi t·∫£i l·∫°i d·ªØ li·ªáu. Vui l√≤ng th·ª≠ l·∫°i.');

			        // Kh√¥i ph·ª•c n√∫t trong tr∆∞·ªùng h·ª£p l·ªói
			        const button = document.getElementById('refresh-button');
			        button.innerHTML = originalText;
			        button.disabled = false;
			    }
			});

			// T·ª± ƒë·ªông c·∫≠p nh·∫≠t m·ªói 30 gi√¢y
			setInterval(async () => {
			    try {
			        await reloadConfig();
			        await updateAdminPanel();
			        await updatePardonStatus();
			    } catch (error) {
			        console.error('L·ªói khi t·ª± ƒë·ªông c·∫≠p nh·∫≠t:', error);
			    }
			}, 30000);
		</script>
	</body>
</html>
